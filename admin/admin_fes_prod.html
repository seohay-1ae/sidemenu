<!doctype html>
<html lang="ko">
	<head>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<link rel="stylesheet" href="../common/styles.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ì¶•ì œ ìƒí’ˆ ì—°ë™</title>
		<style>
			body {
				display: flex;
				flex-direction: column;
				min-height: 100vh;
			}
			.layout {
				display: flex;
				min-height: 100vh;
				flex: 1;
			}
			.main-wrapper {
				display: flex;
				flex-direction: column;
				width: 100%;
			}
			.wrapper {
				width: 100%;
				display: flex;
				flex-direction: column;
				align-items: center;
				padding: 2rem 0;
			}
			.container {
				width: 90%;
				margin: 10rem 0;
				background: #ffffff;
				padding: 20px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
				border-radius: 10px;
				overflow-x: auto;
			}
			.header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
			}
			.header h3 {
				margin: 0;
			}
			table {
				width: 100%;
				border-collapse: collapse;
				text-align: center;
				table-layout: fixed;
			}
			th,
			td {
				border: 1px solid #ccc;
				padding: 8px;
				word-break: break-word;
			}
			th {
				background-color: #f1c40f;
				color: #000;
			}
			.btn-approve,
			.btn-setting {
				background-color: red;
				border: none;
				padding: 5px 10px;
				cursor: pointer;
				font-weight: bold;
				color: white;
			}
			input[type='checkbox'] {
				transform: scale(1.2);
			}
			@media (min-width: 481px) and (max-width: 1024px) {
				.wrapper {
					width: 100%;
					display: flex;
					flex-direction: column;
					align-items: center;
					margin: 2rem 5rem !important;
				}
			}
			@media (max-width: 768px) {
				table {
					font-size: 14px;
				}
			}
			@media (min-width: 481px) {
				.main-wrapper {
					margin-left: 15vw;
				}
			}
			@media (max-width: 480px) {
				.main-wrapper {
					margin-left: 0;
				}
			}

			/* ğŸ’¡ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
			#popup-overlay {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				z-index: 999;
			}

			#popup-modal {
				display: none;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				background: #fff;
				padding: 20px;
				z-index: 1000;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
				width: 80%;
				max-width: 600px;
			}
		</style>
	</head>
	<body>
		<main class="main-wrapper">
			<div class="layout">
				<!-- ì‚¬ì´ë“œë°” ì‚½ì… -->
				<div id="sidebar-container"></div>

				<div class="wrapper">
					<div class="container">
						<div class="header">
							<h3>ì¶•ì œ ìƒí’ˆ ì—°ë™</h3>
						</div>
						<table>
							<thead>
								<tr>
									<th>ì¶•ì œëª…</th>
									<th>ì¥ì†Œ</th>
									<th>ì¶•ì œì‹œì‘ì¼</th>
									<th>ì¶•ì œì¢…ë£Œì¼</th>
									<th>ê´€ë¦¬</th>
									<th>ì—…ë°ì´íŠ¸ì¼</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>ë´„ê½ƒì¶•ì œ</td>
									<td>ì„œìš¸</td>
									<td>2025-04-01</td>
									<td>2025-04-10</td>
									<td><button class="btn-setting">ì„¤ì •</button></td>
									<td>2025-04-10</td>
								</tr>
								<tr>
									<td>ë¶ˆê½ƒë†€ì´</td>
									<td>ë¶€ì‚°</td>
									<td>2025-05-05</td>
									<td>2025-05-06</td>
									<td><button class="btn-setting">ì„¤ì •</button></td>
									<td>2025-04-17</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</main>

		<!-- ğŸ’¡ ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ & íŒì—… -->
		<div id="popup-overlay"></div>
		<div id="popup-modal">
			<h3 style="margin-top: 0">ìƒí’ˆ ì—°ë™ ê´€ë¦¬</h3>
			<table style="width: 100%; border-collapse: collapse; text-align: center">
				<thead>
					<tr>
						<th><input type="checkbox" id="select-all" /></th>
						<th>ìƒí’ˆID</th>
						<th>ìƒí’ˆëª…</th>
						<th>ì¹´í…Œê³ ë¦¬</th>
						<th>ìƒí’ˆì¢…ë¥˜</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD001-A</td>
						<td>ë¬´ìŠ¨ë”¸ê¸°</td>
						<td>ê³¼ì¼</td>
						<td>ë”¸ê¸°</td>
					</tr>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD002-A</td>
						<td>ë¬´ìŠ¨ë”¸ê¸°</td>
						<td>ê³¼ì¼</td>
						<td>ë”¸ê¸°</td>
					</tr>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD003-B</td>
						<td>ë¬´ìŠ¨ë”¸ê¸°</td>
						<td>ê³¼ì¼</td>
						<td>ë”¸ê¸°</td>
					</tr>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD004-A</td>
						<td>ë¬´ìŠ¨ë”¸ê¸°</td>
						<td>ê³¼ì¼</td>
						<td>ë”¸ê¸°</td>
					</tr>
				</tbody>
			</table>
			<div style="text-align: right; margin-top: 10px">
				<button id="connect-products" style="padding: 5px 10px; margin-right: 5px">ì—°ë™í•˜ê¸°</button>
				<button id="close-popup" style="padding: 5px 10px">ë‹«ê¸°</button>
			</div>
		</div>

		<script src="./admin_sidebar.js"></script>
		<script>
			let currentRow;
			let festivalProductStates = {}; // ì¶•ì œë³„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì €ì¥ ê°ì²´

			// ì„¤ì • ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
			$(document).on('click', '.btn-setting', function () {
				currentRow = $(this).closest('tr'); // í˜„ì¬ í´ë¦­í•œ í–‰ ì €ì¥
				const festivalName = currentRow.find('td').eq(0).text(); // ì¶•ì œëª… ê°€ì ¸ì˜¤ê¸° (ì²« ë²ˆì§¸ ì—´)

				// í•´ë‹¹ ì¶•ì œì˜ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸° (ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´)
				const selectedProducts = festivalProductStates[festivalName] || [];

				// ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì„¤ì •
				$('#popup-modal tbody input[type="checkbox"]').each(function () {
					const productId = $(this).closest('tr').find('td').eq(1).text(); // ìƒí’ˆID
					$(this).prop('checked', selectedProducts.includes(productId)); // í•´ë‹¹ ìƒí’ˆIDê°€ ì²´í¬ë˜ì—ˆìœ¼ë©´ ì²´í¬ë°•ìŠ¤ ì„ íƒ
				});

				// ëª¨ë‹¬ ë³´ì´ê¸°
				$('#popup-overlay').show();
				$('#popup-modal').show();
			});

			// ëª¨ë‹¬ ë‹«ê¸° (ì˜¤ë²„ë ˆì´ ë˜ëŠ” ë‹«ê¸° ë²„íŠ¼)
			$('#close-popup, #popup-overlay').on('click', function () {
				$('#popup-modal').hide();
				$('#popup-overlay').hide();
			});

			// ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
			$('#select-all').on('change', function () {
				const isChecked = $(this).is(':checked');
				$('#popup-modal tbody input[type="checkbox"]').prop('checked', isChecked);
			});

			// ì—°ë™í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
			$('#connect-products').on('click', function () {
				// ì²´í¬ëœ ìƒí’ˆID ë°°ì—´ ìƒì„±
				const selectedProducts = [];
				$('#popup-modal tbody input[type="checkbox"]:checked').each(function () {
					const productId = $(this).closest('tr').find('td').eq(1).text();
					selectedProducts.push(productId);
				});

				// ì¶•ì œëª… (ëª¨ë‹¬ì— ì—°ê²°ëœ ì¶•ì œëª…)
				const festivalName = currentRow.find('td').eq(0).text();

				// í•´ë‹¹ ì¶•ì œì˜ ì²´í¬ ìƒíƒœ ì €ì¥
				festivalProductStates[festivalName] = selectedProducts;

				// KST ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
				const today = new Date();
				today.setHours(today.getHours() + 9);
				const formattedDate = today.toISOString().split('T')[0];

				// ì—…ë°ì´íŠ¸ì¼ ì»¬ëŸ¼ ë³€ê²½
				currentRow.find('td').last().text(formattedDate);

				alert('ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');

				// ëª¨ë‹¬ ë‹«ê¸°
				$('#popup-modal').hide();
				$('#popup-overlay').hide();
			});
		</script>
	</body>
</html>
