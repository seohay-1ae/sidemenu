<!doctype html>
<html lang="ko">
	<head>
		<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
		<link rel="stylesheet" href="../common/styles.css" />
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ì¶•ì œ ìƒí’ˆ ì—°ë™</title>
		<style>
			body {
				display: flex;
				flex-direction: column;
				min-height: 100vh;
			}

			.main-wrapper {
				display: flex;
				flex-direction: column;
			}
			.container {
				width: 90%;
				margin: 0;
				background: #ffffff;
				padding: 20px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
				border-radius: 10px;
			}
			.header {
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 20px;
			}
			.header h3 {
				margin: 0;
			}
			table {
				width: 100%;
				border-collapse: collapse;
				text-align: center;
			}
			th,
			td {
				border: 1px solid #ccc;
				padding: 8px;
				white-space: nowrap; /* í…ìŠ¤íŠ¸ëŠ” í•œ ì¤„ë¡œ ìœ ì§€ */
				overflow: hidden; /* ë„˜ì¹œ ë‚´ìš©ì€ ìˆ¨ê¹€ */
				text-overflow: ellipsis; /* ë„˜ì¹œ ë¶€ë¶„ì€ "..."ìœ¼ë¡œ í‘œì‹œ */
			}
			th {
				background-color: #f1c40f;
				color: #000;
			}
			.btn-approve,
			.btn-setting {
				background-color: red;
				border: none;
				padding: 5px 10px;
				cursor: pointer;
				font-weight: bold;
				color: white;
			}
			input[type='checkbox'] {
				transform: scale(1.2);
			}
			.table-container {
				width: 100%;
				overflow-x: auto;
			}
			@media (max-width: 750px) {
				table {
					font-size: 14px;
				}
			}
			@media (max-width: 750px) {
				.main-wrapper {
					margin-left: 0; /* ëª¨ë°”ì¼ì—ì„œëŠ” ì‚¬ì´ë“œë°” ë°€ë¦¬ì§€ ì•Šë„ë¡ ì„¤ì • */
				}
			}

			@media (max-width: 1023px) and (min-width: 750px) {
				.container {
					width: 500px;
					margin: auto;
					margin-top: 120px;
				}
				.col-1 {
					width: 25%;
				}
				.col-2 {
					width: 10%;
				}
				.col-3 {
					width: 10%;
				}
				.col-4 {
					width: 10%;
				}
				.col-5 {
					width: 7%;
				}
				.col-6 {
					width: 10%;
				}
				.table-container {
					overflow-x: scroll;
				}
			}

			@media (min-width: 1024px) {
				.container {
					margin: auto;
					margin-top: 120px;
					width: 980px;
				}
				.col-1 {
					width: 25%;
				}
				.col-2 {
					width: 14%;
				}
				.col-3 {
					width: 8%;
				}
				.col-4 {
					width: 8%;
				}
				.col-5 {
					width: 4%;
				}
				.col-6 {
					width: 7%;
				}
			}

			/* ğŸ’¡ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
			#popup-overlay {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				z-index: 999;
			}

			#popup-modal {
				display: none;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				background: #fff;
				padding: 20px;
				z-index: 1000;
				border-radius: 10px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
				width: 80%;
				max-width: 600px;
			}
		</style>
	</head>
	<body>
		<main class="main-wrapper">
			<!-- ì‚¬ì´ë“œë°” ì‚½ì… -->
			<div id="sidebar-container"></div>

			<div class="container">
				<div class="header">
					<h3>ì¶•ì œ ìƒí’ˆ ì—°ë™</h3>
				</div>
				<div class="table-container">
					<table>
						<thead>
							<tr>
								<th>ì¶•ì œëª…</th>
								<th>ì¥ì†Œ</th>
								<th>ì¶•ì œì‹œì‘ì¼</th>
								<th>ì¶•ì œì¢…ë£Œì¼</th>
								<th>ê´€ë¦¬</th>
								<th>ì—…ë°ì´íŠ¸ì¼</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>ì˜ì²œ ê³¼ì¼ ì¶•ì œ</td>
								<td>ê²½ë¶ ì˜ì²œì‹œ</td>
								<td>2025-10-20</td>
								<td>2025-10-22</td>
								<td><button class="btn-setting">ì„¤ì •</button></td>
								<td></td>
							</tr>
							<tr>
								<td>ì œì£¼ ì¶•ì œ ê°ê·¤ ë°•ëŒíšŒ</td>
								<td>ì œì£¼ ì„œê·€í¬ì‹œ</td>
								<td>2025-11-20</td>
								<td>2025-11-24</td>
								<td><button class="btn-setting">ì„¤ì •</button></td>
								<td></td>
							</tr>
							<tr>
								<td>ì²œì•ˆ ìˆ˜ì‹  ë©œë¡  ì¶•ì œ</td>
								<td>ì¶©ë‚¨ ì²œì•ˆì‹œ</td>
								<td>2025-06-01</td>
								<td>2025-06-02</td>
								<td><button class="btn-setting">ì„¤ì •</button></td>
								<td></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</main>

		<!-- ğŸ’¡ ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ & íŒì—… -->
		<div id="popup-overlay"></div>
		<div id="popup-modal">
			<h3 style="margin-top: 0">ìƒí’ˆ ì—°ë™ ê´€ë¦¬</h3>
			<table style="width: 100%; border-collapse: collapse; text-align: center">
				<colgroup>
					<!-- ì²« ë²ˆì§¸ ì—´ (ì²´í¬ë°•ìŠ¤) -->
					<col class="col-1" />
					<!-- ë‘ ë²ˆì§¸ ì—´ (ìƒí’ˆid) -->
					<col class="col-2" />
					<!-- ì„¸ ë²ˆì§¸ ì—´ (ìƒí’ˆëª…) -->
					<col class="col-3" />
					<!-- ë„¤ ë²ˆì§¸ ì—´ (ì¹´í…Œê³ ë¦¬) -->
					<col class="col-4" />
					<!-- ë‹¤ì„¯ ë²ˆì§¸ ì—´ (ìƒí’ˆì¢…ë¥˜) -->
					<col class="col-5" />
				</colgroup>
				<thead>
					<tr>
						<th><input type="checkbox" id="select-all" /></th>
						<th>ìƒí’ˆID</th>
						<th>ìƒí’ˆëª…</th>
						<th>ì¹´í…Œê³ ë¦¬</th>
						<th>ìƒí’ˆì¢…ë¥˜</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD001-A</td>
						<td>ë‹¬ì½¤í•œ ë³„ë¹› ìƒ¤ì¸ë¨¸ìŠ¤ì¼“</td>
						<td>ê³¼ì¼</td>
						<td>ìƒ¤ì¸ë¨¸ìŠ¤ì¼“</td>
					</tr>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD002-A</td>
						<td>ë”°ëœ»í•œ í–‡ì‚´ì†ì—ì„œ ìë€ ë‹¹ë„ 1ë“±ê¸‰ ì‚¬ê³¼</td>
						<td>ê³¼ì¼</td>
						<td>ì‚¬ê³¼</td>
					</tr>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD003-B</td>
						<td>ë°”ëŒì´ í‚¤ìš´ ë‹¬ì½¤í•œ ê·¤ ì´ì•¼ê¸°</td>
						<td>ê³¼ì¼</td>
						<td>ê·¤</td>
					</tr>
					<tr>
						<td><input type="checkbox" /></td>
						<td>PD004-A</td>
						<td>ì²­ì •í•œ ìˆ˜ì‹ ì—ì„œ ìë€ ë‹¬ì½¤í•œ ë©œë¡ </td>
						<td>ê³¼ì¼</td>
						<td>ë©œë¡ </td>
					</tr>
				</tbody>
			</table>
			<div style="text-align: right; margin-top: 10px">
				<button id="connect-products" style="padding: 5px 10px; margin-right: 5px">ì—°ë™í•˜ê¸°</button>
				<button id="close-popup" style="padding: 5px 10px">ë‹«ê¸°</button>
			</div>
		</div>

		<script src="./admin_sidebar.js"></script>
		<script>
			let festivalProductStates = JSON.parse(localStorage.getItem('festivalProductStates')) || {}; // ì¶•ì œë³„ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì €ì¥ ê°ì²´

			$(document).ready(function () {
				$('table tbody tr').each(function () {
					const festivalName = $(this).find('td').eq(0).text();
					const saved = festivalProductStates[festivalName];
					if (saved && saved.updatedAt) {
						$(this).find('td').last().text(saved.updatedAt);
					}
				});
			});

			let currentRow; // í˜„ì¬ í–‰

			// ì„¤ì • ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
			$(document).on('click', '.btn-setting', function () {
				console.log('ì„¤ì • ë²„íŠ¼ í´ë¦­ë¨'); // ì´ê±° ë„£ì–´ë³´ì„¸ìš”!
				currentRow = $(this).closest('tr'); // í˜„ì¬ í´ë¦­í•œ í–‰ ì €ì¥
				const festivalName = currentRow.find('td').eq(0).text(); // ì¶•ì œëª… ê°€ì ¸ì˜¤ê¸° (ì²« ë²ˆì§¸ ì—´)

				// í•´ë‹¹ ì¶•ì œì˜ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë¶ˆëŸ¬ì˜¤ê¸° (ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´)
				const saved = festivalProductStates[festivalName] || {
					selectedProducts: [],
					updatedAt: '',
				};
				const previouslySelected = saved.selectedProducts || [];
				// ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì„¤ì •
				$('#popup-modal tbody input[type="checkbox"]').each(function () {
					// í˜„ì¬ ì²´í¬ëœ ì²´í¬ë°•ìŠ¤ê°€ í¬í•¨ëœ í–‰ì„ ì°¾ì•„ ë‘ë²ˆì§¸ ì…€ì„(ìƒí’ˆid) ì„ íƒí•˜ê³ , ê·¸ ì…€ì˜ í…ìŠ¤íŠ¸ ë‚´ìš©ì„ ê°€ì ¸ì˜´
					const productId = $(this).closest('tr').find('td').eq(1).text();
					$(this).prop('checked', previouslySelected.includes(productId)); // í•´ë‹¹ ìƒí’ˆIDê°€ ì²´í¬ë˜ì—ˆìœ¼ë©´ ì²´í¬ë°•ìŠ¤ ì„ íƒ (ì²´í¬ë°•ìŠ¤ ìœ ì§€ ë¡œì§)
				});

				// ëª¨ë‹¬ ë³´ì´ê¸°
				$('#popup-overlay').show();
				$('#popup-modal').show();
			});

			// ëª¨ë‹¬ ë‹«ê¸° (ì˜¤ë²„ë ˆì´ ë˜ëŠ” ë‹«ê¸° ë²„íŠ¼)
			$('#close-popup, #popup-overlay').on('click', function () {
				$('#popup-modal').hide();
				$('#popup-overlay').hide();
			});

			// ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤
			$('#select-all').on('change', function () {
				const isChecked = $(this).is(':checked');
				$('#popup-modal tbody input[type="checkbox"]').prop('checked', isChecked);
			});

			// ì—°ë™í•˜ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
			$('#connect-products').on('click', function () {
				// ì²´í¬ëœ ìƒí’ˆID ë°°ì—´ ìƒì„±
				const selectedProducts = [];
				$('#popup-modal tbody input[type="checkbox"]:checked').each(function () {
					const productId = $(this).closest('tr').find('td').eq(1).text();
					selectedProducts.push(productId);
				});

				// KST ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ ê³„ì‚°
				const today = new Date();
				today.setHours(today.getHours() + 9);
				const formattedDate = today.toISOString().split('T')[0];

				// ì¶•ì œëª… (ëª¨ë‹¬ì— ì—°ê²°ëœ ì¶•ì œëª…)
				const festivalName = currentRow.find('td').eq(0).text();
				// í•´ë‹¹ ì¶•ì œì˜ ì²´í¬ ìƒíƒœ ì €ì¥
				festivalProductStates[festivalName] = {
					selectedProducts,
					updatedAt: formattedDate,
				};
				localStorage.setItem('festivalProductStates', JSON.stringify(festivalProductStates));

				// ì—…ë°ì´íŠ¸ì¼ ì»¬ëŸ¼ ë³€ê²½
				currentRow.find('td').last().text(formattedDate);

				alert('ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');

				// ëª¨ë‹¬ ë‹«ê¸°
				$('#popup-modal').hide();
				$('#popup-overlay').hide();
			});
		</script>
	</body>
</html>
